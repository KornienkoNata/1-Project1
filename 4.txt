Процедура ОбработкаПроведения(Отказ, Режим)
	
	 
	// регистр Хозрасчетный 
	Запрос0 = Новый Запрос;
	Запрос0.Текст = 
		"ВЫБРАТЬ
		|	СУММА(ХозрасчетныйОбороты.СуммаОборот) КАК СуммаОборот
		|ПОМЕСТИТЬ ОбщаяСуммаОборота
		|ИЗ
		|	РегистрБухгалтерии.Хозрасчетный.Обороты(&НАчалоПериода, &КонецПериода, , Счет = &Счет, , , , ) КАК ХозрасчетныйОбороты
		|ГДЕ
		|	ХозрасчетныйОбороты.Организация = &Организация
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ХозрасчетныйОбороты.Субконто1 КАК ГруппаНоменклатуры,
		|	ВЫРАЗИТЬ(ХозрасчетныйОбороты.СуммаОборот / ОбщаяСуммаОборота.СуммаОборот * 100 КАК ЧИСЛО(10, 2)) КАК Процент
		|ИЗ
		|	ОбщаяСуммаОборота КАК ОбщаяСуммаОборота,
		|	РегистрБухгалтерии.Хозрасчетный.Обороты(&НАчалоПериода, &КонецПериода, , Счет = &Счет, , , , ) КАК ХозрасчетныйОбороты
		|ГДЕ
		|	ХозрасчетныйОбороты.Организация = &Организация";
	
	
	НачалоПериода = НачалоМесяца(Дата);
	КонецПериода =  КонецМесяца(Дата);
	
	// Создать будущий регистратор. 
	ДатаЗаписи = КонецПериода; 
	Если ЭтоНовый() Тогда
		Документ = Документы.ЗакрытиеСчета26.СоздатьДокумент(); 
		Документ.Дата = ДатаЗаписи; 	
		Документ.Организация = Организация; 		
		Документ.Записать(); 	
	КонецЕсли;	
		
	Запрос0.УстановитьПараметр("Организация",Организация);
	Запрос0.УстановитьПараметр("Счет", ПланыСчетов.Хозрасчетный.НайтиПоКоду("20.01")); 
	Запрос0.УстановитьПараметр("НачалоПериода",НачалоПериода);
	Запрос0.УстановитьПараметр("КонецПериода", КонецПериода);
	
	РезультатЗапроса0 = Запрос0.Выполнить();
	Выборка = РезультатЗапроса0.Выбрать();	
	
	МассивПроцентов = Новый Массив;
	МассивНоменклатурныхГрупп = Новый Массив;
	Пока Выборка.Следующий() Цикл
		МассивНоменклатурныхГрупп.Добавить(Выборка.ГруппаНоменклатуры);
		МассивПроцентов.Добавить(Выборка.Процент);
	КонецЦикла;
	
		
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ХозрасчетныйОстаткиИОбороты.Счет,
		|	ХозрасчетныйОстаткиИОбороты.СуммаКонечныйОстатокДт,
		|	ХозрасчетныйОстаткиИОбороты.Субконто1,
		|	ХозрасчетныйОстаткиИОбороты.Подразделение,
		|	ХозрасчетныйОстаткиИОбороты.Субконто2
		|ИЗ
		|	РегистрБухгалтерии.Хозрасчетный.ОстаткиИОбороты(&НачалоПериода, &КонецПериода, Авто, , Счет = &Счет, , ) КАК ХозрасчетныйОстаткиИОбороты
		|ГДЕ
		|	ХозрасчетныйОстаткиИОбороты.Организация = &Организация";
	
	
	НачалоПериода = НачалоМесяца(Дата);
	КонецПериода =  КонецМесяца(Дата);
	Запрос.УстановитьПараметр("Организация",Организация);
	Запрос.УстановитьПараметр("Счет", ПланыСчетов.Хозрасчетный.ОбщехозяйственныеРасходы);
	Запрос.УстановитьПараметр("НачалоПериода",НачалоПериода);
	Запрос.УстановитьПараметр("КонецПериода", КонецПериода);
	
	РезультатЗапроса = Запрос.Выполнить();
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
			// Создать набор записей. 
		НаборЗаписей = РегистрыБухгалтерии.Хозрасчетный.СоздатьНаборЗаписей();		 
		НаборЗаписей.Отбор.Регистратор.Установить(Ссылка);  
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл							
		
		Движение = НаборЗаписей.Добавить(); 
		Движение.Регистратор = Ссылка; 
		Движение.Период = ДатаЗаписи; 
		 
		
		// Заполнить счет дебета. 
		//Заполним движения по номенклатурным группам.
		Движение.СчетДт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("20.01"); 
		
		//Для  Индекс = 0 По МассивНоменклатурныхГрупп.Количество()-1 цикл
		//	Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконтоХозрасчетные.НоменклатурныеГруппы] = МассивНоменклатурныхГрупп[индекс]; 
		//	Движение.Сумма =  ВыборкаДетальныеЗаписи.СуммаКонечныйОстатокДт* МассивПроцентов[Индекс];
		//КонецЦикла;
		
		// Заполнить аналитику счета дебета. 
		Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконтоХозрасчетные.СтатьиЗатрат] = ВыборкаДетальныеЗаписи.Субконто1; 		
		Движение.ПодразделениеДт = ВыборкаДетальныеЗаписи.Подразделение;  
		// Заполнить счет кредита. 
		Движение.СчетКт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("26"); 
		 
		// Заполнить аналитику счета кредита. 		
		Движение.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконтоХозрасчетные.СтатьиЗатрат] = ВыборкаДетальныеЗаписи.Субконто1; 
		 Движение.ПодразделениеКт = ВыборкаДетальныеЗаписи.Подразделение;  
		 
		// Балансовое измерение. 
		Движение.Организация = Организация; 
		 
		// Балансовый ресурс. 
		Движение.Сумма = ВыборкаДетальныеЗаписи.СуммаКонечныйОстатокДт; 
		 				 		
				
	КонецЦикла;	
	// Записать набор записей. 
	НаборЗаписей.Записать();	

	
КонецПроцедуры
